<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NoCodeCanvas</title>
<style>
    :root {
        --theme-blue: #007bff;
        --theme-blue-dark: #0056b3;
        --theme-light-blue: #e0f7ff;
        --text-dark: #212529;
        --text-light: #495057;
        --border-color: #dee2e6;
        --success-green: #28a745;
        --success-green-dark: #218838;
        --background: #e1effd;
        --editor-bg: #ffffff;
        --toolbar-bg: rgba(255, 255, 255, 0.9);
        --shadow-light: 0 4px 6px rgba(0, 0, 0, 0.05);
        --shadow-medium: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
    }

    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background: var(--background);
        color: var(--text-dark);
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
    }
    
    /* --- General UI --- */
    h1, h2 { color: var(--text-dark); }
    p { color: var(--text-light); line-height: 1.6; }
    button, label, select { cursor: pointer; font-weight: 500; transition: all 0.2s ease; border: none; }

    .screen {
        flex: 1; display: none; flex-direction: column;
        align-items: center; justify-content: center;
        padding: 20px; box-sizing: border-box;
    }
    .screen.active { display: flex; }

    .container {
        padding: 40px 50px; border-radius: 24px; text-align: center;
        display: flex; flex-direction: column; align-items: center;
        width: 100%; max-width: 600px; box-sizing: border-box;
        background: var(--editor-bg);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-medium);
    }
    
    .nice-button {
        background: var(--theme-blue); color: white;
        padding: 12px 24px; border-radius: 10px; font-size: 16px;
        box-shadow: var(--shadow-light);
    }
    .nice-button:hover {
        background: var(--theme-blue-dark);
        transform: translateY(-2px);
    }

    /* --- Home Screen --- */
    #home h1 { margin-bottom: 8px; }
    #home p { margin-top: 0; margin-bottom: 30px; max-width: 500px; text-align: center; }
    
    #dropZone {
        border: 2px dashed var(--border-color); border-radius: 20px;
        padding: 20px; width: 100%; max-width: 400px; margin-bottom: 30px;
        transition: background-color 0.3s, border-color 0.3s;
    }
    #dropZone.drag-over { background-color: var(--theme-light-blue); border-color: var(--theme-blue); }

    .upload-steps { display: flex; flex-direction: column; gap: 15px; width: 100%; }
    .upload-label {
        display: block; padding: 12px 20px; background-color: #f1f3f5;
        color: var(--text-dark); border-radius: 10px;
    }
    .upload-label:hover { background-color: #e9ecef; }
    .upload-label.file-loaded { background-color: var(--theme-blue); color: white; font-weight: bold; }
    input[type="file"] { display: none; }
    
    /* --- Editor Screen --- */
    #editor { padding: 0; justify-content: flex-start; gap: 15px; background: #e9ecef; }
    .editor-header, .editor-footer {
        width: 100%; padding: 10px 20px; box-sizing: border-box;
        background: var(--toolbar-bg);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: flex; align-items: center; z-index: 100;
        box-shadow: var(--shadow-light);
    }

    .editor-header { justify-content: space-between; border-bottom: 1px solid var(--border-color); }
    .view-controls button { background: none; border: 1px solid var(--border-color); border-radius: 8px; padding: 8px; display: flex; align-items: center; justify-content: center; }
    .view-controls button:hover { background: #f1f3f5; }
    .view-controls button.active { background: var(--theme-light-blue); border-color: var(--theme-blue); }
    .view-controls { display: flex; gap: 10px; }
    
    .image-tray { display: flex; gap: 10px; align-items: center; overflow-x: auto; max-width: 70%; }
    .tray-image { width: 50px; height: 50px; object-fit: cover; border-radius: 8px; border: 2px solid var(--border-color); cursor: grab; flex-shrink: 0; }
    .tray-image:active { cursor: grabbing; }
    #addMoreImagesLabel {
        width: 50px; height: 50px; border-radius: 8px; background: #f1f3f5; display: flex;
        align-items: center; justify-content: center; font-size: 24px; color: var(--text-light);
        border: 2px dashed var(--border-color); flex-shrink: 0;
    }
    #addMoreImagesLabel:hover { background: #e9ecef; border-color: var(--text-light); }

    .editor-main { flex: 1; width: 100%; display: flex; justify-content: center; padding: 20px 0; overflow: auto; }
    #preview {
        width: 100%; height: 100%; border: none;
        background: var(--editor-bg); border-radius: 10px;
        box-shadow: var(--shadow-medium); transition: width 0.3s ease-in-out;
    }

    .editor-footer {
        position: fixed; bottom: 20px; left: 50%;
        transform: translateX(-50%); width: auto;
        border-radius: 12px; border-top: 1px solid var(--border-color);
        gap: 8px; padding: 8px 15px;
    }
    .toolbar-btn, .toolbar-select, #importFontBtn {
        background: none; border: none; padding: 8px;
        border-radius: 6px; display: flex; align-items: center;
        font-size: 14px;
    }
    .toolbar-btn:hover, #importFontBtn:hover { background: #e9ecef; }
    .toolbar-btn.active { background: var(--theme-light-blue); }
    #fontSelect { padding: 6px; }
    #importFontBtn { padding: 8px 12px; }
    
    #exportBtn { background: var(--success-green); color: white; padding: 8px 16px; border-radius: 8px; }
    #exportBtn:hover { background: var(--success-green-dark); }
    .divider { width: 1px; background: var(--border-color); height: 20px; margin: 0 8px; }


    /* --- Export Screen --- */
    #exportScreen .container { max-width: 800px; }
    #exportCode {
        width: 100%; height: 40vh; border-radius: 10px; border: 1px solid var(--border-color);
        padding: 15px; font-family: monospace; font-size: 14px; resize: vertical; margin-bottom: 20px;
    }
    .filename-container { display: flex; gap: 10px; width: 100%; align-items: center; margin-bottom: 25px; }
    #filenameInput { flex-grow: 1; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); font-size: 14px; }
    #downloadBtn { background: var(--theme-blue); color: white; padding: 10px 18px; border-radius: 8px; }
    #backToEditorBtn { background: #6c757d; color: white; padding: 10px 16px; border-radius: 8px; }
    .export-buttons { display: flex; gap: 15px; }

    /* --- Footer --- */
    footer { text-align: center; padding: 15px 0; font-size: 13px; color: var(--text-light); }
    footer a { color: var(--theme-blue); font-weight: 500; text-decoration: none; }
    footer a:hover { text-decoration: underline; }

</style>
</head>
<body>

<!-- HOME SCREEN -->
<div id="home" class="screen active">
    <div class="container">
        <h1>NoCodeCanvas</h1>
        <p>Your creative space. Drag and drop your project files into the zone below or click the buttons to upload. An HTML file is required to start.</p>
        
        <div id="dropZone">
            <div class="upload-steps">
                <label for="cssFile" class="upload-label" id="cssLabel">1. Upload CSS (Optional)</label>
                <input type="file" id="cssFile" accept=".css">
                <label for="imgFiles" class="upload-label" id="imgLabel">2. Upload Images (Optional)</label>
                <input type="file" id="imgFiles" accept="image/*" multiple>
                <label for="htmlFile" class="upload-label" id="htmlLabel">3. Upload HTML (Required)</label>
                <input type="file" id="htmlFile" accept=".html,.htm">
            </div>
        </div>
        <button id="startBtn" class="nice-button">Start Editing</button>
    </div>
    <footer style="position:fixed; bottom:0;">
        Made by <a href="https://kaheichan.neocities.org" target="_blank" rel="noopener noreferrer">Ka Hei, Shellcraft Studios</a>. 
        Open Source on <a href="https://github.com/kaheichanturtle/NoCodeCanvas" target="_blank" rel="noopener noreferrer">GitHub</a>. 
        Usage <a href="https://kaheichan.neocities.org/privacyandterms" target="_blank" rel="noopener noreferrer">Terms and Conditions</a> apply.
    </footer>
</div>

<!-- EDITOR SCREEN -->
<div id="editor" class="screen">
    <header class="editor-header">
        <div class="image-tray" id="imageTray">
            <label for="addMoreImages" id="addMoreImagesLabel" title="Add more images">+</label>
            <input type="file" id="addMoreImages" accept="image/*" multiple style="display:none;">
        </div>
        <div class="view-controls">
            <button id="desktopBtn" title="Desktop View" class="active">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
            </button>
            <button id="mobileBtn" title="Mobile View">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect><line x1="12" y1="18" x2="12.01" y2="18"></line></svg>
            </button>
        </div>
    </header>
    <main class="editor-main">
        <iframe id="preview" sandbox="allow-same-origin allow-scripts"></iframe>
    </main>
    <footer class="editor-footer">
        <select id="fontSelect" class="toolbar-select">
            <option value="Arial, sans-serif">Arial</option>
            <option value="Georgia, serif">Georgia</option>
            <option value="Helvetica, sans-serif">Helvetica</option>
            <option value="Times New Roman, serif">Times New Roman</option>
            <option value="Verdana, sans-serif">Verdana</option>
        </select>
        <button id="importFontBtn">Import Font</button>
        <div class="divider"></div>
        <button class="toolbar-btn" id="boldBtn" title="Bold">
             <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path><path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path></svg>
        </button>
        <button class="toolbar-btn" id="italicBtn" title="Italic">
             <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="4" x2="10" y2="4"></line><line x1="14" y1="20" x2="5" y2="20"></line><line x1="15" y1="4" x2="9" y2="20"></line></svg>
        </button>
        <button class="toolbar-btn" id="strikethroughBtn" title="Strikethrough">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4H9a3 3 0 0 0-2.83 4"/><path d="M14 12a4 4 0 0 1 0 8H6"/><line x1="4" y1="12" x2="20" y2="12"/></svg>
        </button>
        <button class="toolbar-btn" id="linkBtn" title="Create Link">
             <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path></svg>
        </button>
        <div class="divider"></div>
        <button id="exportBtn">Save & Export</button>
    </footer>
</div>

<!-- EXPORT SCREEN -->
<div id="exportScreen" class="screen">
    <div class="container">
        <h2>Your Updated Code</h2>
        <p>You can copy the code below or download the file with a custom name.</p>
        <textarea id="exportCode" readonly></textarea>
        <div class="filename-container">
            <input type="text" id="filenameInput" value="edited-page.html">
            <button id="downloadBtn" class="nice-button">Download</button>
        </div>
        <div class="export-buttons">
            <button id="backToEditorBtn">Back to Editor</button>
        </div>
    </div>
</div>

<script>
    const screens = { home: document.getElementById('home'), editor: document.getElementById('editor'), export: document.getElementById('exportScreen'), };
    const inputs = { css: document.getElementById('cssFile'), images: document.getElementById('imgFiles'), html: document.getElementById('htmlFile'), addMoreImages: document.getElementById('addMoreImages'), };
    const labels = { css: document.getElementById('cssLabel'), images: document.getElementById('imgLabel'), html: document.getElementById('htmlLabel'), };
    const dropZone = document.getElementById('dropZone');
    const startBtn = document.getElementById('startBtn');
    const preview = document.getElementById('preview');
    const imageTray = document.getElementById('imageTray');

    const desktopBtn = document.getElementById('desktopBtn'), mobileBtn = document.getElementById('mobileBtn');
    const boldBtn = document.getElementById('boldBtn'), italicBtn = document.getElementById('italicBtn'), strikethroughBtn = document.getElementById('strikethroughBtn'), linkBtn = document.getElementById('linkBtn');
    const fontSelect = document.getElementById('fontSelect'), importFontBtn = document.getElementById('importFontBtn');
    
    const exportBtn = document.getElementById('exportBtn'), backToEditorBtn = document.getElementById('backToEditorBtn'), downloadBtn = document.getElementById('downloadBtn');
    const exportCodeArea = document.getElementById('exportCode'), filenameInput = document.getElementById('filenameInput');

    let htmlContent = '', cssContent = '', htmlFileName = 'index.html';
    const imageMap = {};
    const importedFontLinks = [];

    function showScreen(screenName) { Object.values(screens).forEach(s => s.classList.remove('active')); screens[screenName]?.classList.add('active'); }

    function updateFileIndicator(labelEl, fileNames) {
        labelEl.classList.add('file-loaded');
        const count = fileNames.length;
        if (labelEl === labels.images) { labelEl.textContent = `${count} Image${count > 1 ? 's' : ''} Loaded ✔`; } 
        else { labelEl.textContent = `${fileNames[0]} ✔`; }
    }

    function processFiles(files) {
        const fileList = Array.from(files);
        const htmlFiles = fileList.filter(f => f.name.endsWith('.html') || f.name.endsWith('.htm'));
        const cssFiles = fileList.filter(f => f.name.endsWith('.css'));
        const imgFiles = fileList.filter(f => f.type.startsWith('image/'));
        imgFiles.forEach(file => {
            const reader = new FileReader();
            reader.onload = evt => {
                imageMap[file.name] = evt.target.result;
                updateImageTray();
                updateFileIndicator(labels.images, Object.keys(imageMap));
            };
            reader.readAsDataURL(file);
        });
        if (cssFiles.length > 0) {
            const reader = new FileReader();
            reader.onload = evt => {
                cssContent = evt.target.result;
                updateFileIndicator(labels.css, [cssFiles[0].name]);
            };
            reader.readAsText(cssFiles[0]);
        }
        if (htmlFiles.length > 0) {
            const reader = new FileReader();
            reader.onload = evt => {
                htmlContent = evt.target.result;
                htmlFileName = htmlFiles[0].name;
                updateFileIndicator(labels.html, [htmlFiles[0].name]);
            };
            reader.readAsText(htmlFiles[0]);
        }
    }

    function updateImageTray() {
        imageTray.innerHTML = `<label for="addMoreImages" id="addMoreImagesLabel" title="Add more images">+</label><input type="file" id="addMoreImages" accept="image/*" multiple style="display:none;">`;
        document.getElementById('addMoreImages').addEventListener('change', (e) => processFiles(e.target.files));
        for (const name in imageMap) {
            const img = document.createElement('img');
            img.src = imageMap[name];
            img.className = 'tray-image';
            img.draggable = true;
            img.addEventListener('dragstart', e => { e.dataTransfer.setData('text/plain', imageMap[name]); });
            imageTray.appendChild(img);
        }
    }

    function loadPreview() {
        let content = htmlContent;
        Object.keys(imageMap).forEach(name => {
            const regex = new RegExp(`(src|href)=["'](.*[/])?${name}["']`, 'g');
            content = content.replace(regex, `$1="${imageMap[name]}"`);
        });
        if (cssContent) {
            content = content.replace('</head>', `<style id="page-styles">${cssContent}</style></head>`);
        }
        preview.srcdoc = content;
        preview.onload = () => {
            const doc = preview.contentDocument;
            doc.body.setAttribute('contentEditable', 'true');
            injectEditorLogic(doc);
        };
    }
    
    function injectEditorLogic(doc) {
        const style = doc.createElement('style');
        style.id = 'editor-styles';
        style.innerHTML = `
            .editor-image-wrapper { position: relative; display: inline-block; line-height: 0; }
            .editor-image-wrapper > img { outline: 2px solid #007bff; }
            .editor-control {
                position: absolute; width: 22px; height: 22px;
                background: white; border: 1px solid #007bff;
                border-radius: 50%; display: flex; align-items: center; justify-content: center;
                color: #007bff; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            }
            .editor-resizer { bottom: -8px; right: -8px; cursor: se-resize; }
            .editor-delete-btn { top: -8px; right: -8px; cursor: pointer; font-size: 16px; font-weight: bold; }
            .drop-indicator { outline: 2px dashed #007bff !important; background: rgba(0, 123, 255, 0.1) !important; }
        `;
        doc.head.appendChild(style);

        const script = doc.createElement('script');
        script.id = 'editor-script';
        script.innerHTML = `
            let selectedImageWrapper = null;
            let currentDropTarget = null;

            document.addEventListener('click', (e) => {
                if(e.target.tagName === 'IMG') { e.preventDefault(); selectImage(e.target); }
                else if (selectedImageWrapper && !selectedImageWrapper.contains(e.target)) { deselectImage(); }
            });

            document.body.addEventListener('dragenter', (e) => {
                if (e.target.tagName !== 'HTML' && e.target.tagName !== 'BODY') {
                    currentDropTarget = e.target;
                    currentDropTarget.classList.add('drop-indicator');
                }
            });
            document.body.addEventListener('dragleave', () => {
                if (currentDropTarget) {
                    currentDropTarget.classList.remove('drop-indicator');
                    currentDropTarget = null;
                }
            });
            document.body.addEventListener('dragover', (e) => e.preventDefault());
            document.body.addEventListener('drop', (e) => {
                e.preventDefault();
                if (currentDropTarget) {
                    currentDropTarget.classList.remove('drop-indicator');
                }
                const dataUrl = e.dataTransfer.getData('text/plain');
                if (!dataUrl || !e.target) return;

                if (e.target.tagName === 'IMG') {
                    e.target.src = dataUrl;
                } else {
                    const newImg = document.createElement('img');
                    newImg.src = dataUrl;
                    newImg.style.maxWidth = '100%';
                    e.target.closest('div, p, section, article, header, footer, a').appendChild(newImg);
                }
            });

            function deselectImage() {
                if (!selectedImageWrapper) return;
                const img = selectedImageWrapper.querySelector('img');
                selectedImageWrapper.parentNode.replaceChild(img, selectedImageWrapper);
                selectedImageWrapper = null;
            }

            function selectImage(img) {
                if (img.parentElement.classList.contains('editor-image-wrapper')) return;
                deselectImage();
                
                const wrapper = document.createElement('div');
                wrapper.className = 'editor-image-wrapper';
                img.parentNode.insertBefore(wrapper, img);
                wrapper.appendChild(img);
                selectedImageWrapper = wrapper;

                const resizer = document.createElement('div');
                resizer.className = 'editor-control editor-resizer';
                wrapper.appendChild(resizer);
                
                const deleteBtn = document.createElement('div');
                deleteBtn.className = 'editor-control editor-delete-btn';
                deleteBtn.innerHTML = '×';
                deleteBtn.onclick = () => wrapper.remove();
                wrapper.appendChild(deleteBtn);
                
                let startX, startY, startWidth;
                resizer.addEventListener('mousedown', (e) => {
                    e.preventDefault(); e.stopPropagation();
                    startX = e.clientX; startY = e.clientY;
                    startWidth = img.width;
                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                });
                function onMouseMove(e) { img.style.width = (startWidth + (e.clientX - startX)) + 'px'; img.style.height = 'auto'; }
                function onMouseUp() { document.removeEventListener('mousemove', onMouseMove); document.removeEventListener('mouseup', onMouseUp); }
            }
        `;
        doc.body.appendChild(script);
    }

    function generateExportHTML() {
        const doc = preview.contentDocument.cloneNode(true);
        doc.querySelectorAll('[contenteditable]').forEach(el => el.removeAttribute('contenteditable'));
        doc.getElementById('editor-styles')?.remove();
        doc.getElementById('editor-script')?.remove();
        
        // "Unwrap" images from their control wrappers
        doc.querySelectorAll('.editor-image-wrapper').forEach(wrapper => {
            const img = wrapper.querySelector('img');
            if (img) wrapper.parentNode.replaceChild(img, wrapper);
        });

        let finalHTML = '<!DOCTYPE html>\n' + doc.documentElement.outerHTML;

        if (importedFontLinks.length > 0) {
            const fontHTML = importedFontLinks.join('\n');
            finalHTML = finalHTML.replace('</head>', `${fontHTML}\n</head>`);
        }
        
        return finalHTML;
    }

    function showModal(message) { 
         const modal = document.createElement('div');
        modal.innerHTML = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 9999;">
            <div style="background: white; padding: 30px; border-radius: 10px; text-align: center; box-shadow: var(--shadow-medium);">
              <p style="margin-top:0; margin-bottom:20px;">${message}</p>
              <button class="nice-button" onclick="this.parentElement.parentElement.remove()">OK</button>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
    }
    
    ['css', 'images', 'html'].forEach(key => inputs[key].addEventListener('change', e => processFiles(e.target.files)));
    dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
    dropZone.addEventListener('drop', e => { e.preventDefault(); dropZone.classList.remove('drag-over'); processFiles(e.dataTransfer.files); });
    startBtn.addEventListener('click', () => { if (!htmlContent) { showModal("Please upload an HTML file to start."); return; } showScreen('editor'); loadPreview(); });
    inputs.addMoreImages.addEventListener('change', (e) => processFiles(e.target.files));
    desktopBtn.addEventListener('click', () => { preview.style.width = '100%'; desktopBtn.classList.add('active'); mobileBtn.classList.remove('active'); });
    mobileBtn.addEventListener('click', () => { preview.style.width = '375px'; mobileBtn.classList.add('active'); desktopBtn.classList.remove('active'); });
    
    boldBtn.addEventListener('click', () => preview.contentDocument.execCommand('bold'));
    italicBtn.addEventListener('click', () => preview.contentDocument.execCommand('italic'));
    strikethroughBtn.addEventListener('click', () => preview.contentDocument.execCommand('strikethrough'));
    linkBtn.addEventListener('click', () => { const url = prompt('Enter the URL:', 'https://'); if (url) preview.contentDocument.execCommand('createLink', false, url); });
    fontSelect.addEventListener('change', (e) => preview.contentDocument.execCommand('fontName', false, e.target.value));

    importFontBtn.addEventListener('click', () => {
        const linkTag = prompt('Paste the Google Font <link> tag here:');
        if (linkTag && linkTag.includes('stylesheet')) {
            preview.contentDocument.head.insertAdjacentHTML('beforeend', linkTag);
            importedFontLinks.push(linkTag);
            const fontNameMatch = linkTag.match(/family=([^&:]+)/);
            if(fontNameMatch && fontNameMatch[1]) {
                const fontName = fontNameMatch[1].replace(/\+/g, ' ');
                const option = new Option(fontName, fontName);
                fontSelect.add(option);
                option.selected = true;
                fontSelect.dispatchEvent(new Event('change')); 
            }
        } else if (linkTag) {
            alert('Invalid <link> tag. Please provide the full tag from Google Fonts.');
        }
    });

    exportBtn.addEventListener('click', () => {
        exportCodeArea.value = generateExportHTML();
        filenameInput.value = `${htmlFileName.replace(/\.(html|htm)$/, '')}-edited.html`;
        showScreen('export');
    });

    // Export Screen
    downloadBtn.addEventListener('click', () => { const blob = new Blob([exportCodeArea.value], { type: 'text/html' }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filenameInput.value || 'edited-page.html'; a.click(); URL.revokeObjectURL(a.href); });
    backToEditorBtn.addEventListener('click', () => showScreen('editor'));
</script>

</body>
</html>
